spack:
  specs:
  - phlex
  - catch2
  - cmake
  - lcov
  - ninja
  - py-gcovr
  - py-pip # Needed temporarily for ruff installation
  - |
      llvm@21.1.4: +zstd +llvm_dylib +link_llvm_dylib ~lldb targets=x86

  view: true

  concretizer:
    unify: true
    reuse:
      from:
        - type: external
        - type: local
        - type: buildcache

  packages:
    all:
      target:
      - x86_64_v3

    cmake:
      require:
      - "%%c,cxx=gcc@13.3.0"
      - "~qtgui"
      - "@4:"

    phlex:
      require:
      - "+form"
      - "cxxstd=23"
      - "%gcc@15"


    # GCC 15 uses C23 as the default C language, and the versions of
    # libunwind and unuran available in Spack (as of 8/12/2025) do not
    # yet support C23.
    libunwind:
      require:
      - "cflags='-std=c17'"

    unuran:
      require:
      - "cflags='-std=c17'"

    # ROOT should be built with the same version of the C++ standard
    # as will be used by Phlex (C++23 for now).
    root:
      require:
      - "~x"  # No graphics libraries required
      # FIXME: davix requires openssl headers which are not currently
      #        available in the container.  They are also not needed
      #        for Phlex development.  This should be rectified.
      - "~davix"
      - "cxxstd=23"
